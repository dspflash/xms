<operator refresh="1" firstpage="1" prepage="1" nextpage="1">
<op text="Dispatch"><submit next="xtmst_dispatchplan_v.xtmst_dispatchplan.GBDEDITxtmst_dispatchplan" function="reset"/><DbDetails><Where>f.freightid='%{xtmst_freight_vLst[freightid]}'</Where></DbDetails><submit namelist="DbDetails" next="xtmst_dispatchplan_v.xtmst_dispatchplan.freightid"/><assign name="xtmst_dispatchplan_v.xtmst_dispatchplan.frmwndctrl" expr="%{this}"/><!--DbDetails><Where>carrierid=(select carrierid from xtmst_freight where freightid='%{xtmst_freight_vLst[freightid]}')</Where></DbDetails><submit namelist="DbDetails" next="xtmst_dispatchplan_v.xtmst_dispatchplan.carrierid"/--></op>
<!--op text="DispatchVehicle"><DbDetails><Where>VehicleRealTimeID = (select VehicleRealTimeID from xtmst_dispatchplan where freightid='%{xtmst_freight_vLst[freightid]}')</Where></DbDetails><submit namelist="DbDetails" next="xtmst_vehiclerealtime_v.xtmst_vehiclerealtime.xtmst_vehiclerealtimeLst"/></op-->
<op text="modify"><DbDetails><Where>freightid='%{xtmst_freight_vLst[freightid]}' and STATUS=200</Where></DbDetails><submit namelist="DbDetails" next="$this.xtmst_freight.xtmst_freightLst"/><DbDetails><Where>PickupOrderID=(select PickupOrderID from tms.xtmst_freight where freightid='%{xtmst_freight_vLst[freightid]}')</Where></DbDetails><submit namelist="DbDetails" next="$this.xtmst_freight.PickupOrderID"/><DbDetails><Where>CityID=(select FromCityID from tms.xtmst_freight where freightid='%{xtmst_freight_vLst[freightid]}')</Where></DbDetails><submit namelist="DbDetails" next="$this.xtmst_freight.FromCityID"/><DbDetails><Where>CityID=(select ToCityID from tms.xtmst_freight where freightid='%{xtmst_freight_vLst[freightid]}')</Where></DbDetails><submit namelist="DbDetails" next="$this.xtmst_freight.ToCityID"/><DbDetails><Where>XSiteID=(select FromXSiteID from tms.xtmst_freight where freightid='%{xtmst_freight_vLst[freightid]}')</Where></DbDetails><submit namelist="DbDetails" next="$this.xtmst_freight.FromXSiteID"/><DbDetails><Where>XSiteID=(select ToXSiteID from tms.xtmst_freight where freightid='%{xtmst_freight_vLst[freightid]}')</Where></DbDetails><submit namelist="DbDetails" next="$this.xtmst_freight.ToXSiteID"/></op>
<op text="cancel" needconfirm="1"><DbDetails>
<DbTable>tms.xtmst_freight</DbTable>
<Where>freightid='%{xtmst_freight_vLst[freightid]}' and status in (201,200)</Where>
<queryFormat>set @vrtid=null;set @pkid=null;select PickupOrderID into @pkid from %{table} ld where %{where};
update %{table} set status=220 where %{where};update tms.xtmst_pickuporder set orderstatus=101 where PickupOrderID=@pkid;
delete from tms.xtmst_dispatchplan where freightid='%{xtmst_freight_vLst[freightid]}';
</queryFormat></DbDetails>DELETE vrt FROM (tms.xtmst_vehiclerealtime vrt LEFT JOIN tms.xtmst_dispatchplan dp ON !vrt.IsManual AND vrt.VehicleRealTimeID=dp.VehicleRealTimeID) WHERE planid IS NULL AND vrt.VehicleRealTimeID=@vrtid;
<submit namelist="DbDetails"/><submit/></op>
<op text="delete" needconfirm="1"><DbDetails>
<DbTable>tms.xtmst_freight</DbTable>
<Where>freightid='%{xtmst_freight_vLst[freightid]}' and status=208</Where>
<queryFormat>delete from %{table} where %{where}</queryFormat></DbDetails>
<submit namelist="DbDetails"/><submit/></op>
<op text="Complain"><submit next="xtmst_complain_v.xtmst_complain.GBDEDITxtmst_complain" function="reset"/><DbDetails><Where>FreightID='%{%{this}[FreightID]}'</Where></DbDetails><submit namelist="DbDetails" next="xtmst_complain_v.xtmst_complain.xtmst_complainLst"/><submit namelist="DbDetails" next="xtmst_complain_v.xtmst_complain.FreightID"/><assign name="xtmst_complain_v.xtmst_complain.frmwndctrl" expr="%{this}"/></op>
<op text="Fineorder"><submit next="xtmst_fineorder_v.xtmst_fineorder.GBDEDITxtmst_fineorder" function="reset"/><DbDetails><Where>FreightID='%{%{this}[FreightID]}'</Where></DbDetails><submit namelist="DbDetails" next="xtmst_fineorder_v.xtmst_fineorder.xtmst_fineorderLst"/><DbDetails><Where>f.FreightID='%{%{this}[FreightID]}'</Where></DbDetails><submit namelist="DbDetails" next="xtmst_fineorder_v.xtmst_fineorder.FreightID"/><assign name="xtmst_fineorder_v.xtmst_fineorder.frmwndctrl" expr="%{this}"/></op>
</operator>
